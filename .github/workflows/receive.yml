name : receive

on:
  repository_dispatch:
    types: [new-version-available]

jobs:
  send_version:
    runs-on: ubuntu-latest
    steps:
      - name: install yq
        run: |
          sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CC86BB64
          sudo add-apt-repository ppa:rmescandon/yq -y
          sudo apt update -y
          sudo apt install yq -y

      - uses: actions/checkout@v2

      - name: Update Version
        run: |
          yq w --inplace config/properties.yml 'app.version.tag' "${{ github.event.client_payload.version }}"
      
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          commit-message: Update Version to ${{ github.event.client_payload.version }}
          title: Update Version to ${{ github.event.client_payload.version }}
          body: |
            - Updatating version to [1]

              Auto-generated by [repository_dispatch_send][2]

            [1]: ${{ github.event.client_payload.version }}
            [2]: https://github.com/steviemul/repository_dispatch_send
          branch: update-version-to-${{ github.event.client_payload.version }}
